<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waktu Sholat Real-Time</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- AOS for Animations -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #e0e7ff, #c3e8d1);
            transition: all 0.3s ease;
        }
        .sidebar {
            background: linear-gradient(180deg, #a9bd83 0%, #7a9b5e 100%);
            transition: transform 0.3s ease;
        }
        .sidebar a {
            transition: all 0.2s ease;
        }
        .sidebar a:hover {
            transform: translateX(10px);
            background: #fef6bf;
            color: #264653;
        }
        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.05);
        }
        .dark-mode {
            background: linear-gradient(135deg, #1a1a1a, #2c2c2c);
            color: #e0e0e0;
        }
        .dark-mode .card {
            background: rgba(40, 40, 40, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .dark-mode .sidebar, .dark-mode .footer {
            background: #1c1c1c;
        }
        .dark-mode .btn-dark-mode i {
            color: #f1c40f;
        }
        .select-city, .method-select, .country-display {
            transition: all 0.3s ease;
        }
        .select-city:focus, .method-select:focus, .country-display:focus {
            border-color: #34d399;
            box-shadow: 0 0 0 3px rgba(52, 211, 153, 0.2);
        }
        .btn-primary {
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .btn-primary:hover {
            background-color: #059669;
            transform: scale(1.05);
        }
        .prayer-times {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .prayer-times.loaded {
            opacity: 1;
        }
        .dark-mode .prayer-times i {
            filter: brightness(1.2);
        }
        .country-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }
        .country-display {
            font-size: 1.5rem;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
            transition: transform 0.6s ease, opacity 0.6s ease, box-shadow 0.3s ease;
        }
        .country-display.active {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(52, 211, 153, 0.4);
            opacity: 1;
        }
        .country-display.leaving {
            opacity: 0;
            transform: translateX(-100%);
        }
        .country-display.entering {
            opacity: 0;
            transform: translateX(100%);
        }
        .nav-btn {
            margin: 0 1rem;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        .nav-btn:hover {
            transform: scale(1.1);
            background-color: #059669;
        }
        .particle {
            position: absolute;
            width: 5px;
            height: 5px;
            background: rgba(52, 211, 153, 0.6);
            border-radius: 50%;
            animation: float 2s infinite;
        }
        @keyframes float {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.2); }
            100% { transform: translateY(0) scale(1); }
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .country-nav {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="flex">
        <!-- Sidebar -->
        <nav class="sidebar fixed w-64 md:w-80 min-h-screen p-4 text-white shadow-lg z-50">
            <header class="text-center mb-6">
                <h3 class="text-2xl font-bold" data-aos="fade-down">IbadahVibes</h3>
            </header>
            <ul class="list-unstyled space-y-2">
                <li data-aos="fade-right" data-aos-delay="100">
                    <a href="home.html" class="flex items-center p-3 rounded-lg">
                        <i class="fa-solid fa-kaaba mr-2"></i> Sholat Wajib
                    </a>
                </li>
                <li data-aos="fade-right" data-aos-delay="200">
                    <a href="sunnah.html" class="flex items-center p-3 rounded-lg">
                        <i class="fas fa-mosque mr-2"></i> Sholat Sunnah
                    </a>
                </li>
                <li data-aos="fade-right" data-aos-delay="300">
                    <a href="ibadahtracker.html" class="flex items-center p-3 rounded-lg">
                        <i class="fa-solid fa-book-quran mr-2"></i> Ibadah Tracker
                    </a>
                </li>
                <li data-aos="fade-right" data-aos-delay="400">
                    <a href="quote.html" class="flex items-center p-3 rounded-lg">
                        <i class="fa-solid fa-quote-right mr-2"></i> Quotes Gaul
                    </a>
                </li>
                <li data-aos="fade-right" data-aos-delay="500">
                    <a href="waktu-sholat.html" class="flex items-center p-3 rounded-lg bg-fef6bf text-264653">
                        <i class="fa-solid fa-clock mr-2"></i> Waktu Sholat
                    </a>
                </li>
                <li data-aos="fade-right" data-aos-delay="600">
                    <a href="about.html" class="flex items-center p-3 rounded-lg">
                        <i class="fa-solid fa-address-card mr-2"></i> About Us
                    </a>
                </li>
            </ul>
            <div class="mt-auto text-center">
                <button class="btn bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-full">
                    <a href="index.html" class="text-white no-underline">Peace Out</a>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container-fluid p-6 md:ml-80">
            <header class="flex justify-between items-center mb-6" data-aos="fade-up">
                <button class="btn text-2xl md:hidden" onclick="toggleSidebar()">☰</button>
                <h1 class="text-3xl md:text-4xl font-bold">Waktu Sholat Real-Time</h1>
                <button id="darkModeToggle" class="btn btn-dark-mode px-4 py-2 rounded-full bg-gray-800 text-white hover:bg-gray-700">
                    <i class="fas fa-moon"></i>
                </button>
            </header>

            <!-- Country and City Selection -->
            <div class="country-nav mb-6" data-aos="fade-up">
                <button id="prevCountry" class="nav-btn btn btn-primary px-4 py-2 rounded-full"><i class="fas fa-chevron-left"></i></button>
                <div id="countryDisplay" class="country-display active">Indonesia</div>
                <button id="nextCountry" class="nav-btn btn btn-primary px-4 py-2 rounded-full"><i class="fas fa-chevron-right"></i></button>
            </div>

            <!-- Prayer Times Content -->
            <div class="card p-8 rounded-xl" data-aos="fade-up" data-aos-delay="200">
                <h2 class="text-2xl font-semibold mb-6">Waktu Sholat di Dunia</h2>
                <div class="mb-6 flex flex-col md:flex-row md:space-x-4">
                    <div class="flex-1">
                        <label for="citySelect" class="block text-lg font-medium mb-2">Pilih Kota:</label>
                        <select id="citySelect" class="select-city w-full p-3 rounded-lg border border-gray-300 focus:outline-none">
                            <option value="Jakarta">Jakarta</option>
                            <option value="Bandung">Bandung</option>
                            <option value="Surabaya">Surabaya</option>
                        </select>
                    </div>
                    <div class="flex-1 mt-4 md:mt-0">
                        <label for="methodSelect" class="block text-lg font-medium mb-2">Metode Kalkulasi:</label>
                        <select id="methodSelect" class="method-select w-full p-3 rounded-lg border border-gray-300 focus:outline-none">
                            <option value="5">Muslim World League</option>
                            <option value="1">Islamic Society of North America (ISNA)</option>
                            <option value="2">Egyptian General Authority</option>
                            <option value="3" selected>Umm Al-Qura University, Makkah</option>
                            <option value="4">University of Islamic Sciences, Karachi</option>
                            <option value="7">Institute of Geophysics, University of Tehran</option>
                            <option value="8">Gulf Region</option>
                        </select>
                    </div>
                </div>
                <div id="prayerTimes" class="prayer-times text-lg space-y-3">
                    <p class="flex items-center"><i class="fas fa-spinner fa-spin mr-2"></i> Memuat waktu sholat...</p>
                </div>
            </div>

            <!-- Footer -->
            <footer class="text-center py-4 bg-gray-900 text-white rounded-xl mt-6" data-aos="fade-up" data-aos-delay="300">
                <p>© verlangid 2022-2025. All Rights Reserved.</p>
            </footer>
        </div>
    </div>

    <!-- AOS JS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        AOS.init({ duration: 800, once: true });

        document.getElementById('darkModeToggle').onclick = function() {
            document.body.classList.toggle('dark-mode');
            const icon = this.querySelector('i');
            icon.classList.toggle('fa-moon');
            icon.classList.toggle('fa-sun');
        };

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('active');
        }

        // Daftar negara dan kota
        const countries = [
            {
                name: "Afghanistan",
                cities: ["Kabul", "Kandahar", "Herat", "Mazar-i-Sharif", "Jalalabad"]
            },
            {
                name: "Indonesia",
                cities: [
                    "Ambon", "Balikpapan", "Banda Aceh", "Bandar Lampung", "Bandung", "Banjar", "Banjarbaru", "Banjarmasin",
                    "Batam", "Batu", "Baubau", "Bekasi", "Bengkulu", "Bima", "Binjai", "Bitung", "Blitar", "Bogor",
                    "Bontang", "Bukittinggi", "Cilegon", "Cimahi", "Cirebon", "Denpasar", "Depok", "Dumai", "Gorontalo",
                    "Gunungsitoli", "Jakarta", "Jambi", "Jayapura", "Kediri", "Kendari", "Kotamobagu", "Kupang",
                    "Langsa", "Lhokseumawe", "Lubuklinggau", "Madiun", "Magelang", "Makassar", "Malang", "Manado",
                    "Mataram", "Medan", "Metro", "Mojokerto", "Padang", "Padangpanjang", "Padangsidimpuan", "Pagar Alam",
                    "Palangka Raya", "Palembang", "Palopo", "Palu", "Pangkalpinang", "Parepare", "Pariaman", "Pasuruan",
                    "Payakumbuh", "Pekalongan", "Pekanbaru", "Pematangsiantar", "Pontianak", "Prabumulih", "Probolinggo",
                    "Sabang", "Salatiga", "Samarinda", "Sawahlunto", "Semarang", "Serang", "Sibolga", "Singkawang",
                    "Solok", "Sorong", "Subang", "Subulussalam", "Sukabumi", "Sungai Penuh", "Surabaya", "Surakarta", "Tangerang",
                    "Tangerang Selatan", "Tanjungbalai", "Tanjungpinang", "Tarakan", "Tasikmalaya", "Tebing Tinggi",
                    "Tegal", "Ternate", "Tidore Kepulauan", "Tomohon", "Tual", "Yogyakarta",
                    "Amlapura", "Bangkalan", "Banyuwangi", "Batang", "Belitung", "Belitung Timur", "Berau", "Bireuen",
                    "Blora", "Bojonegoro", "Bondowoso", "Cianjur", "Cilacap", "Demak", "Dompu", "Enrekang", "Gianyar",
                    "Gresik", "Indramayu", "Jember", "Jeneponto", "Jepara", "Kebumen", "Kediri (Kabupaten)", "Klaten",
                    "Kolaka", "Kudus", "Kulon Progo", "Kuningan", "Labuhanbatu", "Lamongan", "Langkat", "Lombok Barat",
                    "Lombok Tengah", "Lombok Timur", "Lumajang", "Madiun (Kabupaten)", "Magetan", "Majalengka",
                    "Manggarai Barat", "Manggarai Timur", "Maros", "Merauke", "Minahasa", "Muara Enim", "Nganjuk",
                    "Ngawi", "Pacitan", "Padalarang", "Pamekasan", "Pandeglang", "Pasaman", "Paser", "Pati",
                    "Pemalang", "Polewali Mandar", "Ponorogo", "Purwakarta", "Purworejo", "Rembang", "Sampang",
                    "Sanggau", "Sidenreng Rappang", "Sidoarjo", "Simalungun", "Sleman", "Sragen", "Sukoharjo",
                    "Sumedang", "Sumbawa", "Tabalong", "Takalar", "Tanah Laut", "Tanah Datar", "Tapanuli Selatan",
                    "Tapin", "Temanggung", "Tolitoli", "Trenggalek", "Tuban", "Tulungagung", "Wajo", "Wonogiri",
                    "Wonosobo"
                ]
            },
            {
                name: "Malaysia",
                cities: ["Kuala Lumpur", "George Town", "Johor Bahru", "Ipoh", "Shah Alam"]
            }
        ];
        let currentCountryIndex = countries.findIndex(c => c.name === "Indonesia");

        function createParticles(count) {
            const nav = document.querySelector('.country-nav');
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 2}s`;
                nav.appendChild(particle);
            }
        }
        createParticles(10);

        function updateCountryDisplay() {
            const countryDisplay = document.getElementById('countryDisplay');
            const citySelect = document.getElementById('citySelect');
            const oldDisplay = countryDisplay.cloneNode(true);
            oldDisplay.classList.remove('active');
            oldDisplay.classList.add('leaving');
            countryDisplay.parentNode.appendChild(oldDisplay);

            setTimeout(() => {
                countryDisplay.textContent = countries[currentCountryIndex].name;
                citySelect.innerHTML = '';
                countries[currentCountryIndex].cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
                countryDisplay.classList.remove('entering');
                countryDisplay.classList.add('active');
                oldDisplay.remove();
                fetchPrayerTimes(countries[currentCountryIndex].cities[0]);
            }, 300);

            countryDisplay.classList.add('entering');
            setTimeout(() => countryDisplay.classList.remove('entering'), 0);
        }

        document.getElementById('prevCountry').addEventListener('click', () => {
            currentCountryIndex = (currentCountryIndex - 1 + countries.length) % countries.length;
            updateCountryDisplay();
        });

        document.getElementById('nextCountry').addEventListener('click', () => {
            currentCountryIndex = (currentCountryIndex + 1) % countries.length;
            updateCountryDisplay();
        });

        // Fungsi debounce untuk membatasi panggilan API
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Sanitasi input untuk permintaan API
        function sanitizeInput(input) {
            return encodeURIComponent(input.trim().replace(/[^a-zA-Z0-9\s-]/g, ''));
        }

        // Ambil waktu sholat dengan logika retry
        async function fetchPrayerTimes(city, retries = 2, delay = 1000) {
            const prayerTimesDiv = document.getElementById('prayerTimes');
            const method = document.getElementById('methodSelect').value;
            prayerTimesDiv.classList.remove('loaded');
            prayerTimesDiv.innerHTML = '<p class="flex items-center"><i class="fas fa-spinner fa-spin mr-2"></i> Memuat waktu sholat...</p>';

            const country = countries[currentCountryIndex].name;
            const sanitizedCity = sanitizeInput(city);
            const sanitizedCountry = sanitizeInput(country);

            if (!sanitizedCity || !sanitizedCountry) {
                prayerTimesDiv.innerHTML = '<p class="text-red-500"><i class="fas fa-exclamation-circle mr-2"></i> Kota atau negara tidak valid.</p>';
                prayerTimesDiv.classList.add('loaded');
                return;
            }

            const url = `https://api.aladhan.com/v1/timingsByCity?city=${sanitizedCity}&country=${sanitizedCountry}&method=${method}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                if (data.code !== 200) {
                    throw new Error(`API error: ${data.status}`);
                }

                const timings = data.data.timings;
                const date = data.data.date.readable;

                const prayerTimesHtml = `
                    <p class="font-semibold text-xl"><i class="fas fa-calendar-day mr-2 text-gray-600"></i> Tanggal: ${date}</p>
                    <p><i class="fas fa-sun mr-2 text-yellow-500"></i> Subuh: ${timings.Fajr}</p>
                    <p><i class="fas fa-cloud-sun mr-2 text-blue-500"></i> Dzuhur: ${timings.Dhuhr}</p>
                    <p><i class="fas fa-cloud mr-2 text-gray-500"></i> Ashar: ${timings.Asr}</p>
                    <p><i class="fas fa-sunset mr-2 text-orange-600"></i> Maghrib: ${timings.Maghrib}</p>
                    <p><i class="fas fa-moon mr-2 text-indigo-500"></i> Isya: ${timings.Isha}</p>
                `;
                prayerTimesDiv.innerHTML = prayerTimesHtml;
                setTimeout(() => prayerTimesDiv.classList.add('loaded'), 100);
            } catch (error) {
                if (retries > 0) {
                    console.warn(`Mencoba ulang untuk ${city}, ${country}. Sisa percobaan: ${retries}`);
                    setTimeout(() => fetchPrayerTimes(city, retries - 1, delay * 2), delay);
                    return;
                }
                console.error('Gagal mengambil waktu sholat:', error);
                prayerTimesDiv.innerHTML = `
                    <p class="text-red-500"><i class="fas fa-exclamation-circle mr-2"></i> Gagal memuat waktu sholat: ${error.message}</p>
                    <p class="text-sm text-gray-600 mt-2">Silakan coba lagi atau pilih kota lain.</p>
                `;
                prayerTimesDiv.classList.add('loaded');
            }
        }

        // Debounce fetchPrayerTimes
        const debouncedFetchPrayerTimes = debounce(fetchPrayerTimes, 500);

        // Load waktu sholat awal
        updateCountryDisplay();

        // Perbarui waktu sholat saat kota atau metode berubah
        document.getElementById('citySelect').addEventListener('change', function() {
            const city = this.value.trim();
            if (city) {
                debouncedFetchPrayerTimes(city); // Perbaikan: ganti 'City' menjadi 'city'
            }
        });

        document.getElementById('methodSelect').addEventListener('change', function() {
            const city = document.getElementById('citySelect').value.trim();
            if (city) {
                debouncedFetchPrayerTimes(city);
            }
        });
    </script>
</body>
</html>